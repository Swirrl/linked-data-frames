<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mapping Statistical Geography • ldf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mapping Statistical Geography">
<meta property="og:description" content="ldf">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ldf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Linked data frames</li>
    <li>
      <a href="../articles/introduction-to-ldf.html">Introduction to LDF</a>
    </li>
    <li>
      <a href="../articles/creating-ldf-resources.html">Creating LDF Resources</a>
    </li>
    <li>
      <a href="../articles/working-with-ldf-intervals.html">Working with LDF Intervals</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Data cubes</li>
    <li>
      <a href="../articles/mapping-statistical-geography.html">Mapping Statistical Geography</a>
    </li>
    <li>
      <a href="../articles/tabulate-datacube.html">Tabulating DataCubes</a>
    </li>
    <li>
      <a href="../articles/merging-datacubes.html">Merging DataCubes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Swirrl/linked-data-frames/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="mapping-statistical-geography_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="mapping-statistical-geography_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="mapping-statistical-geography_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mapping Statistical Geography</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Swirrl/linked-data-frames/blob/master/vignettes/mapping-statistical-geography.Rmd"><code>vignettes/mapping-statistical-geography.Rmd</code></a></small>
      <div class="hidden name"><code>mapping-statistical-geography.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how to visualise data with maps using UK Statistical Geography resources from the <a href="https://www.ons.gov.uk/">Office for National Statistics (ONS)</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://swirrl.github.io/linked-data-frames">ldf</a></span>)
</pre></div>
<div id="what-is-a-statistical-geography" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-a-statistical-geography" class="anchor"></a>What is a Statistical Geography?</h2>
<p>The ONS maintains a registry of Statistical Geographies. These are areas in the UK, as defined by various geographic hierarchies (e.g. Council areas in an Administrative hierarhcy or NHS Regions in the Health hierarchy). Each area is issued with a code and an official name along with other information (e.g. what the parent area is or the geometry of the boundary).</p>
<p>The data comes from the <a href="https://geoportal.statistics.gov.uk/">ONS Geoportal</a> which has an RDF representation available from <a href="http://statistics.data.gov.uk/">ONS Geography Linked Data</a>.</p>
</div>
<div id="downloading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-data" class="anchor"></a>Downloading data</h2>
<p>We’ll start by downloading some data. We’ll be looking at <a href="https://staging.gss-data.org.uk/cube/explore?uri=http%3A%2F%2Fgss-data.org.uk%2Fdata%2Fgss_data%2Fcovid-19%2Fwg-notifications-of-deaths-of-residents-related-to-covid-19-in-adult-care-homes-catalog-entry">deaths in Welsh care homes</a>.</p>
<p>We’re not going to use <code><a href="../reference/get_cube.html">get_cube()</a></code> but instead use SPARQL to extract a slice from the cube. Our query will filter the observations to find deaths by any cause and which took place in any location (i.e. in an Ambulance or Hospice etc). We’ll use the <code>GROUP BY</code> clause to <code>SUM</code> the count of deaths. This gives us a total number of deaths amoung care home users in Wales since records began.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">wales_ch_deaths</span> <span class="op">&lt;-</span> <span class="st">"
PREFIX wgd: &lt;http://gss-data.org.uk/data/gss_data/covid-19/wg-notifications-of-deaths-of-residents-related-to-covid-19-in-adult-care-homes#dimension/&gt;
PREFIX cause: &lt;http://gss-data.org.uk/data/gss_data/covid-19/wg-notifications-of-deaths-of-residents-related-to-covid-19-in-adult-care-homes#concept/cause-of-death/&gt;
PREFIX location: &lt;http://gss-data.org.uk/data/gss_data/covid-19/wg-notifications-of-deaths-of-residents-related-to-covid-19-in-adult-care-homes#concept/location-of-death/&gt;

SELECT ?geo (SUM(?deaths) AS ?total_deaths)
WHERE {
  ?obs wgd:cause-of-death cause:total ;
       wgd:location-of-death location:total;
       &lt;http://gss-data.org.uk/def/measure/count&gt; ?deaths ;
       wgd:notification-date ?date ;
       wgd:area-code ?geo .
  ?geo &lt;http://statistics.data.gov.uk/def/statistical-entity#code&gt; &lt;http://statistics.data.gov.uk/id/statistical-entity/W06&gt; .

}

GROUP BY ?geo
"</span>
</pre></div>
<p>Then we can execute the query against the COGS SPARQL endpoint:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query.html">query</a></span>(<span class="kw">wales_ch_deaths</span>, <span class="st">"https://staging.gss-data.org.uk/sparql"</span>)
</pre></div>
<p>This is what the response looks like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">deaths</span>))
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">geo</th>
<th align="right">total_deaths</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><a href="http://statistics.data.gov.uk/id/statistical-geography/W06000009" class="uri">http://statistics.data.gov.uk/id/statistical-geography/W06000009</a></td>
<td align="right">172</td>
</tr>
<tr class="even">
<td align="left"><a href="http://statistics.data.gov.uk/id/statistical-geography/W06000010" class="uri">http://statistics.data.gov.uk/id/statistical-geography/W06000010</a></td>
<td align="right">336</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://statistics.data.gov.uk/id/statistical-geography/W06000011" class="uri">http://statistics.data.gov.uk/id/statistical-geography/W06000011</a></td>
<td align="right">350</td>
</tr>
<tr class="even">
<td align="left"><a href="http://statistics.data.gov.uk/id/statistical-geography/W06000012" class="uri">http://statistics.data.gov.uk/id/statistical-geography/W06000012</a></td>
<td align="right">222</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://statistics.data.gov.uk/id/statistical-geography/W06000013" class="uri">http://statistics.data.gov.uk/id/statistical-geography/W06000013</a></td>
<td align="right">235</td>
</tr>
<tr class="even">
<td align="left"><a href="http://statistics.data.gov.uk/id/statistical-geography/W06000014" class="uri">http://statistics.data.gov.uk/id/statistical-geography/W06000014</a></td>
<td align="right">158</td>
</tr>
</tbody>
</table>
<p>The <code>geo</code> column provides us with a character vector of URIs for statistical geographies. We can use these URIs to download descriptions of the geographies. We use <code><a href="../reference/get_geography.html">get_geography()</a></code> to download the descriptions from the ONS Linked Geography endpoint. Note we’re setting a flag to also download the boundaries.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geography.html">get_geography</a></span>(<span class="kw">deaths</span><span class="op">$</span><span class="kw">geo</span>, include_geometry = <span class="kw">T</span>)
</pre></div>
</div>
<div id="creating-a-thematic-map" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-thematic-map" class="anchor"></a>Creating a thematic map</h2>
<p>We can use these boundaries to visualise the data on a map.</p>
<p>The modern approach to spatial data in R is to create a simple feature <code>sf</code> object. This is a data frame with a particular column chosen to be the active geometry.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://r-spatial.github.io/sf">sf</a></span>)
<span class="co">#&gt; Linking to GEOS 3.7.1, GDAL 2.2.3, PROJ 4.9.3</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="kw">geo_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>(<span class="kw">geo</span>, wkt=<span class="st">"boundary"</span>, crs=<span class="st">"WGS84"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">deaths</span>, geo=<span class="fu"><a href="../reference/uri.html">uri</a></span>(<span class="kw">geo</span>)), by=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"uri"</span>=<span class="st">"geo"</span>))
</pre></div>
<p>Finally, we can use this <code>sf</code> object in <code>ggplot</code> to create a choropleth:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">geo_sf</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(fill=<span class="kw">total_deaths</span>), colour=<span class="st">"white"</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>(<span class="st">"Total Deaths"</span>) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(title=<span class="st">"Deaths among Care Home Users in Wales"</span>, 
       subtitle=<span class="st">"Since the outbreak of COVID-19"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()
</pre></div>
<p><img src="mapping-statistical-geography_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://infonomics.ltd.uk">Robin Gower</a>, <a href="https://www.swirrl.com"><img src="https://www.swirrl.com/icons/icon-512x512.png" height="24"> Swirrl</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
