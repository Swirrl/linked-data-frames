<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with LDF Intervals • ldf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with LDF Intervals">
<meta property="og:description" content="ldf">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ldf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Linked data frames</li>
    <li>
      <a href="../articles/introduction-to-ldf.html">Introduction to LDF</a>
    </li>
    <li>
      <a href="../articles/creating-ldf-resources.html">Creating LDF Resources</a>
    </li>
    <li>
      <a href="../articles/working-with-ldf-intervals.html">Working with LDF Intervals</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Data cubes</li>
    <li>
      <a href="../articles/mapping-statistical-geography.html">Mapping Statistical Geography</a>
    </li>
    <li>
      <a href="../articles/tabulate-datacube.html">Tabulating DataCubes</a>
    </li>
    <li>
      <a href="../articles/merging-datacubes.html">Merging DataCubes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Swirrl/linked-data-frames/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="working-with-ldf-intervals_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="working-with-ldf-intervals_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="working-with-ldf-intervals_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with LDF Intervals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Swirrl/linked-data-frames/blob/master/vignettes/working-with-ldf-intervals.Rmd"><code>vignettes/working-with-ldf-intervals.Rmd</code></a></small>
      <div class="hidden name"><code>working-with-ldf-intervals.Rmd</code></div>

    </div>

    
    
<p>This vignette describes how to work with LDF intervals. We’ll work towards visualising a time series chart.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://swirrl.github.io/linked-data-frames">ldf</a></span>)
</pre></div>
<div id="the-interval-ontology" class="section level2">
<h2 class="hasAnchor">
<a href="#the-interval-ontology" class="anchor"></a>The Interval Ontology</h2>
<p>LDF intervals provide a new vector type for representing reference.data.gov.uk intervals. These intervals are created using the <a href="https://github.com/epimorphics/IntervalServer/blob/master/interval-uris.md">interval ontology</a>.</p>
<p>The ontology describes a URI pattern like <a href="http://reference.data.gov.uk/id/month/2020-11">http://reference.data.gov.uk/id/month/2020-11</a>. If you dereference this URI (click on the link), you’ll get an RDF document back describing the interval.</p>
<p>The description is quite verbose, enumerating all of the days contained in the month and calling it an “An interval of 1 month beginning at the start of the 1st second of 1st minute of 1st hour of Sunday the 1st November 2020 in the Gregorian Calendar”.</p>
</div>
<div id="time-is-infinte" class="section level2">
<h2 class="hasAnchor">
<a href="#time-is-infinte" class="anchor"></a>Time is infinte</h2>
<p>We could treat intervals like any other RDF resource. We could figure out a tabular representation of the facts we care about (e.g. a label, start and end instants etc) then use <code><a href="../reference/resource.html">resource()</a></code> to build an ldf resource vector.</p>
<p>Unfortunately, there’s no SPARQL endpoint we can use to download the interval descriptions. Any tool for executing SPARQL queries needs triple statements to work from. We can’t load all time into a database because it’s infinite. We could make the problem tractable by setting limits on precision and time range but that would still lead to a very large set of data of which only very few resources were ever used.</p>
<p>We could alternatively create our URIs then download the description for each from the intervals API. This would work, but it would be quite cumbersome. Indeed if we know the descriptions we need, and how they relate to the interval URIs then we can recreate the logic of the API ourselves, obviating the need to make any HTTP requests.</p>
<p>This is exactly what LDF intervals provide - a set of functions which, given an interval URI, can determine the description.</p>
</div>
<div id="working-with-ldf-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-ldf-intervals" class="anchor"></a>Working with LDF intervals</h2>
<p>Creating an interval is quite simple, we only need provide a URI (as a character vector):</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">nov2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interval.html">interval</a></span>(<span class="st">"http://reference.data.gov.uk/id/month/2020-11"</span>)
</pre></div>
<p>We get a label to represent this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">nov2020</span>
<span class="co">#&gt; &lt;ldf_interval[1]&gt;</span>
<span class="co">#&gt; [1] 2020-11</span>
</pre></div>
<p>We can also get to the start and end instants:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="../reference/int_start.html">int_start</a></span>(<span class="kw">nov2020</span>)
<span class="co">#&gt; [1] "2020-11-01"</span>
</pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="../reference/int_end.html">int_end</a></span>(<span class="kw">nov2020</span>)
<span class="co">#&gt; [1] "2020-11-30"</span>
</pre></div>
</div>
<div id="visualising-ldf-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#visualising-ldf-intervals" class="anchor"></a>Visualising LDF intervals</h2>
<p>These functions return objects of class <code>Date</code> which means we can use them in, for example, ggplot.</p>
<p>To demonstrate this we’ll first downloading a data cube designed to help track the impact of the CoViD-19 pandemic.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">price_changes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cube.html">get_cube</a></span>(<span class="st">"http://gss-data.org.uk/data/gss_data/covid-19/ons-online-price-changes-for-high-demand-products#dataset"</span>)
</pre></div>
<p>We can then extracting a time series from it - here, the price of Toilet Paper.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>, warn.conflicts = <span class="kw">F</span>)
<span class="kw">tp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">price_changes</span>, <span class="fu"><a href="../reference/property.html">property</a></span>(<span class="kw">price_changes</span><span class="op">$</span><span class="kw">product</span>, <span class="st">"notation"</span>)<span class="op">==</span><span class="st">"toilet-rolls"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">tp</span>)
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   measure_type reference_period product      percent unit_of_measure    </span>
<span class="co">#&gt;   &lt;ldf_rsrc&gt;   &lt;ldf_ntrv&gt;       &lt;ldf_rsrc&gt;     &lt;dbl&gt; &lt;ldf_rsrc&gt;         </span>
<span class="co">#&gt; 1 Percent      2020-03-16 P7D   Toilet rolls    100  Price Change Indice</span>
<span class="co">#&gt; 2 Percent      2020-03-23 P7D   Toilet rolls    100. Price Change Indice</span>
<span class="co">#&gt; 3 Percent      2020-03-30 P7D   Toilet rolls    101. Price Change Indice</span>
<span class="co">#&gt; 4 Percent      2020-04-06 P7D   Toilet rolls    101  Price Change Indice</span>
<span class="co">#&gt; 5 Percent      2020-04-13 P7D   Toilet rolls    101. Price Change Indice</span>
<span class="co">#&gt; 6 Percent      2020-04-20 P7D   Toilet rolls    103. Price Change Indice</span>
</pre></div>
<p>The interval is used for the <code>reference_period</code> column.</p>
<p>We can use another interval to describe the duration of the <a href="https://en.wikipedia.org/wiki/COVID-19_pandemic_lockdowns#United_Kingdom">UK stay-at-home order</a>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">lockdown</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/interval.html">interval</a></span>(<span class="st">"http://reference.data.gov.uk/id/gregorian-interval/2020-03-23T00:00:00/P49D"</span>)
</pre></div>
<p>The we can plot these together:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">tp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="fu"><a href="../reference/int_start.html">int_start</a></span>(<span class="kw">reference_period</span>), <span class="kw">percent</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="st">"rect"</span>,
           xmin=<span class="fu"><a href="../reference/int_start.html">int_start</a></span>(<span class="kw">lockdown</span>),
           xmax=<span class="fu"><a href="../reference/int_end.html">int_end</a></span>(<span class="kw">lockdown</span>),
           ymin=<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="kw">tp</span><span class="op">$</span><span class="kw">percent</span>),
           ymax=<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="kw">tp</span><span class="op">$</span><span class="kw">percent</span>),
           fill=<span class="st">"cornflowerblue"</span>,alpha=<span class="fl">0.5</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span>(<span class="st">"text"</span>,
           x=(<span class="fu"><a href="../reference/int_end.html">int_end</a></span>(<span class="kw">lockdown</span>) <span class="op">-</span> <span class="fu"><a href="../reference/int_start.html">int_start</a></span>(<span class="kw">lockdown</span>)) <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="fu"><a href="../reference/int_start.html">int_start</a></span>(<span class="kw">lockdown</span>),
           y=<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="kw">tp</span><span class="op">$</span><span class="kw">percent</span>), hjust=<span class="st">"middle"</span>, vjust=<span class="op">-</span><span class="fl">1</span>, colour=<span class="st">"white"</span>, fontface=<span class="st">"bold"</span>,
           label=<span class="st">"Stay-at-Home\norder in place"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a></span>() <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(title=<span class="st">"Toilet Paper Prices"</span>, x=<span class="st">"Date"</span>,y=<span class="st">"Price index"</span>) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()
</pre></div>
<p><img src="working-with-ldf-intervals_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>It looks like the panic-buying had slowed (at least relative to supply) even before the lockdown restrictions were lifted.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://infonomics.ltd.uk">Robin Gower</a>, <a href="https://www.swirrl.com"><img src="https://www.swirrl.com/icons/icon-512x512.png" height="24"> Swirrl</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
